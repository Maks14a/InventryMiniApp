<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iventry Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        .btn-main { background-color: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color); }
    </style>
</head>
<body class="p-4 flex flex-col h-screen">

    <h1 class="text-xl font-bold mb-4 text-center">üì∏ –ú–æ–∏ –∞–ª—å–±–æ–º—ã</h1>

    <div id="album-list" class="flex-grow overflow-y-auto space-y-2 mb-4">
        <p class="text-center opacity-50">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–æ–≤...</p>
    </div>

    <div class="grid grid-cols-3 gap-2 border-t pt-4">
        <label class="btn-main p-3 rounded-lg text-center cursor-pointer">
            <span class="block text-2xl">üñº</span>
            <span class="text-xs font-medium">–ì–∞–ª–µ—Ä–µ—è</span>
            <input type="file" accept="image/*" multiple class="hidden" onchange="uploadFiles(this)">
        </label>

        <label class="btn-main p-3 rounded-lg text-center cursor-pointer">
            <span class="block text-2xl">‚ûï</span>
            <span class="text-xs font-medium">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</span>
            <input type="file" accept="image/*" capture="environment" class="hidden" onchange="uploadFiles(this)">
        </label>

        <button onclick="shareAlbum()" class="btn-main p-3 rounded-lg text-center">
            <span class="block text-2xl">üîó</span>
            <span class="text-xs font-medium">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</span>
        </button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // 1. –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
        function uploadFiles(input) {
            const files = input.files;
            if (files.length > 0) {
                tg.showConfirm(`–ó–∞–≥—Ä—É–∑–∏—Ç—å ${files.length} —Ñ–æ—Ç–æ?`, (ok) => {
                    if (ok) {
                        tg.showAlert("–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ –±–∞–∑—É!");
                        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç fetch() –∫ —Ç–≤–æ–µ–º—É API –Ω–∞ Amvera
                    }
                });
            }
        }

        // 2. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∞–ª—å–±–æ–º–æ–º
        function shareAlbum() {
            const albumId = "123"; // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±–µ—Ä–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π ID
            const shareUrl = `https://t.me/8589049869?start=alb_${albumId}`;
            tg.switchInlineQuery(shareUrl, ["users", "groups"]);
        }

        // 3. –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–ª—å–±–æ–º–æ–≤ (–Ω—É–∂–µ–Ω API!)
        function loadAlbums() {
            const list = document.getElementById('album-list');
            // –í –±—É–¥—É—â–µ–º —Ç—É—Ç fetch('/get_albums?user_id=' + tg.initDataUnsafe.user.id)
            const fakeAlbums = [{id: 1, name: "–°–≤–∞–¥—å–±–∞"}, {id: 2, name: "–î–Ω—é—Ö–∞"}];
            
            list.innerHTML = fakeAlbums.map(a => `
                <div class="p-3 bg-white/10 rounded-xl border border-white/20 flex justify-between items-center" onclick="selectAlbum(${a.id})">
                    <span>${a.name}</span>
                    <span class="text-xs opacity-50 font-mono">ID: ${a.id}</span>
                </div>
            `).join('');
        }

        loadAlbums();
    </script>
</body>
</html>
